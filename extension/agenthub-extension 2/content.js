let i=!1,l=null,o=null,c=[];const p=()=>o||(o=document.createElement("div"),Object.assign(o.style,{position:"absolute",pointerEvents:"none",border:"2px solid #2563eb",background:"rgba(37, 99, 235, 0.12)",zIndex:"2147483647"}),document.documentElement.appendChild(o),o),h=()=>{o?.remove(),o=null},g=e=>{if(e.id)return`//*[@id="${e.id}"]`;const n=[];let t=e;for(;t&&t.nodeType===Node.ELEMENT_NODE;){let r=1,s=t.previousElementSibling;for(;s;)s.nodeName===t.nodeName&&r++,s=s.previousElementSibling;n.unshift(`${t.nodeName.toLowerCase()}[${r}]`),t=t.parentElement}return"/"+n.join("/")},u=e=>{if(!i)return;const n=document.elementFromPoint(e.clientX,e.clientY);if(!n||n===document.documentElement||n===document.body)return;l=n;const t=n.getBoundingClientRect(),r=p();Object.assign(r.style,{top:`${t.top+window.scrollY}px`,left:`${t.left+window.scrollX}px`,width:`${t.width}px`,height:`${t.height}px`})},m=e=>{if(!i||(e.preventDefault(),e.stopPropagation(),!l))return;const n=(l.innerText||"").trim();n&&c.push({text:n,xpath:g(l)})},a=e=>{i&&(e.key==="Escape"||e.key==="Enter")&&d()},E=()=>{i||(i=!0,c=[],document.addEventListener("mousemove",u,!0),document.addEventListener("click",m,!0),document.addEventListener("keydown",a,!0))},d=()=>{i=!1,document.removeEventListener("mousemove",u,!0),document.removeEventListener("click",m,!0),document.removeEventListener("keydown",a,!0),h(),chrome.runtime.sendMessage({type:"ah:selectionUpdate",payload:c})};chrome.runtime.onMessage.addListener(e=>{e?.type==="ah:startSelecting"&&E()});
